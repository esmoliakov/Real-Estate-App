@page "/login"
@inject RealEstateApp.Client.Services.AuthService AuthService
@inject NavigationManager NavigationManager

<head>
    <PageTitle>Login</PageTitle>
    <link rel="stylesheet" href="css/global.css" />
</head>


<!-- Topbar -->
<div class="topbar">
    <span class="brand"><a href="/">RealeCOM</a></span>
    <nav>
        <a href="/">Home</a>
        <a href="/upload">Upload a listing</a>
        <a href ="/login" class="login" >Sign in/Sign up</a>
    </nav>
</div>

<div class="login-page">
    <!-- Login card -->
    <div class="auth-container">
        <h3>Login / Register</h3>

        <div class="form-group">
            <label>Username</label>
            <InputText class="form-control" @bind-Value="username" />
        </div>

        <div class="form-group">
            <label>Password</label>
            <InputText class="form-control" type="password" @bind-Value="password" />
        </div>

        <div class="button-group">
            <button class="btn btn-primary" @onclick="HandleLogin">Login</button>
            <button class="btn btn-secondary" @onclick="HandleRegister">Register</button>
        </div>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="text-danger">@message</div>
        }
    </div>
</div>

@code {
    private string username = string.Empty;
    private string password = string.Empty;
    private string? message;

    private async Task HandleLogin()
    {
        message = null;
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            message = "Username and password are required.";
            return;
        }

        bool success = await AuthService.LoginAsync(username, password);
        if (success)
        {
            NavigationManager.NavigateTo("/upload");
        }
        else
        {
            message = "Invalid username or password.";
        }
    }

    private async Task HandleRegister()
    {
        message = null;
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            message = "Username and password are required.";
            return;
        }

        bool success = await AuthService.RegisterAsync(username, password);
        if (success)
        {
            message = "Registration successful! You can now log in.";
        }
        else
        {
            message = "Username already exists or registration failed.";
        }
    }
}
