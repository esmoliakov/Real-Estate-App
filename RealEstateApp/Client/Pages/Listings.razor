@page "/"
@using RealEstateApp.Shared.Models
@inject Client.Services.ListingApiService ListingApiService


<PageTitle>RealeCOM</PageTitle>
<div class="topbar">
    <span class="brand">RealeCOM</span>
    <nav>
        <a href="/upload">Upload a listing</a>
    </nav>
</div>



<div class="listings-container">
    <h3>Property listings</h3>

    @if (isLoading)
    {
        <p>Loading...</p>
    }
    else if (!string.IsNullOrEmpty(loadError))
    {
        <p class="text-danger">@loadError</p>
    }
    else if (listings.Count == 0)
    {
        <p>No listings available</p>
    }
    else
    {
        <ul>
            @foreach (var listing in listings)
            {
                <li>
                    <a href="/listing/@listing.Id">
                        <strong>@listing.Type</strong> in @listing.Address — @listing.Area m², @listing.Price.ToString("C")
                    </a>
                </li>
            }
        </ul>
    }
</div>


@code {
    private List<Listing> listings = new();
    private bool isLoading;
    private string? loadError;

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        try
        {
            listings = await ListingApiService.GetListingsAsync() ?? new List<Listing>();
        }
        catch (Exception ex)
        {
            loadError = ex.Message;
        }
        finally
        {
            isLoading = false;
        }
    }
}
